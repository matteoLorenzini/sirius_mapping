PREFIX xsd:  <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX cidoc:<http://www.cidoc-crm.org/cidoc-crm/>

#############################################
### 1) Update cidoc:P90_has_value
#############################################
DELETE {
  ?dim cidoc:P90_has_value ?oldVal .
}
INSERT {
  ?dim cidoc:P90_has_value ?newVal .
}
WHERE {
  ?dim cidoc:P90_has_value ?oldVal .

  BIND( STR(?oldVal) AS ?str )

  # Only string values need conversion
  FILTER(
       LCASE(?str) = "none"
    || REGEX(?str, "^[0-9]+(\\.[0-9]+)?$")
  )

  BIND(
    IF(
      LCASE(?str) = "none",
      xsd:decimal(0),
      xsd:decimal(?str)
    )
    AS ?newVal
  )
};

#############################################
### 2) Update rdfs:label (used in A/B/C scale + uncertainty)
#############################################
DELETE {
  ?dim rdfs:label ?oldLabel .
}
INSERT {
  ?dim rdfs:label ?newLabel .
}
WHERE {
  ?dim rdfs:label ?oldLabel .

  BIND( STR(?oldLabel) AS ?str )

  # Only update numeric-like or "None"
  FILTER(
       LCASE(?str) = "none"
    || REGEX(?str, "^[0-9]+(\\.[0-9]+)?$")
  )

  BIND(
    IF(
      LCASE(?str) = "none",
      xsd:decimal(0),
      xsd:decimal(?str)
    )
    AS ?newLabel
  )
}


## Location

PREFIX dc:     <http://purl.org/dc/elements/1.1/>
PREFIX a-loc:  <https://w3id.org/arco/ontology/location/>
PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?subject ?address ?addressLabel
WHERE {
  ?subject dc:subject <http://culturaitalia.it/pico/thesaurus/4.1#beni_architettonici> ;
           dc:coverage "Ravenna (RA)" ;
           a-loc:hasCulturalPropertyAddress ?address .

  OPTIONAL {
    ?address rdfs:label ?addressLabel .
  }
}

## Chronology

PREFIX dc:     <http://purl.org/dc/elements/1.1/>
PREFIX a-cd:   <https://w3id.org/arco/ontology/context-description/>
PREFIX ti:     <https://w3id.org/italia/onto/TI/>
PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?subject ?dating ?time ?timeLabel
WHERE {
  ?subject dc:subject <http://culturaitalia.it/pico/thesaurus/4.1#beni_architettonici> ;
           dc:coverage "Ravenna (RA)" ;
           a-cd:hasDating ?dating .

  OPTIONAL {
    ?dating a-cd:hasDatingEvent ?datingEvent .
    ?datingEvent ti:atTime ?time .
    OPTIONAL {
      ?time rdfs:label ?timeLabel .
    }
  }
}


## Usage

PREFIX dc:     <http://purl.org/dc/elements/1.1/>
PREFIX a-cd:   <https://w3id.org/arco/ontology/context-description/>
PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?subject ?use ?useFunction ?useFunctionLabel
WHERE {
  ?subject dc:subject <http://culturaitalia.it/pico/thesaurus/4.1#beni_architettonici> ;
           dc:coverage "Ravenna (RA)" ;
           a-cd:hasUse ?use .

  OPTIONAL {
    ?use a-cd:useFunction ?useFunction .
    OPTIONAL {
      ?useFunction rdfs:label ?useFunctionLabel .
    }
  }
}

## Administrative Context

PREFIX dc:     <http://purl.org/dc/elements/1.1/>
PREFIX arco:   <https://w3id.org/arco/ontology/arco/>
PREFIX skos:   <http://www.w3.org/2004/02/skos/core#>

SELECT DISTINCT ?subject ?agency ?agencyLabel
WHERE {
  ?subject dc:subject <http://culturaitalia.it/pico/thesaurus/4.1#beni_architettonici> ;
           dc:coverage "Ravenna (RA)" ;
           arco:hasCataloguingAgency ?agency .

  OPTIONAL {
    ?agency skos:prefLabel ?agencyLabel .
  }
}


## Unified SPARQL

PREFIX dc:     <http://purl.org/dc/elements/1.1/>
PREFIX a-loc:  <https://w3id.org/arco/ontology/location/>
PREFIX a-cd:   <https://w3id.org/arco/ontology/context-description/>
PREFIX arco:   <https://w3id.org/arco/ontology/arco/>
PREFIX ti:     <https://w3id.org/italia/onto/TI/>
PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>
PREFIX skos:   <http://www.w3.org/2004/02/skos/core#>

SELECT DISTINCT
  ?subject

  ## Location
  ?address
  ?addressLabel

  ## Chronology
  ?dating
  ?time
  ?timeLabel

  ## Usage
  ?use
  ?useFunction
  ?useFunctionLabel

  ## Administrative context
  ?agency
  ?agencyLabel
WHERE {
  ?subject dc:subject <http://culturaitalia.it/pico/thesaurus/4.1#beni_architettonici> ;
           dc:coverage "Ravenna (RA)" .

  ## Location
  OPTIONAL {
    ?subject a-loc:hasCulturalPropertyAddress ?address .
    OPTIONAL {
      ?address rdfs:label ?addressLabel .
    }
  }

  ## Chronology
  OPTIONAL {
    ?subject a-cd:hasDating ?dating .
    OPTIONAL {
      ?dating a-cd:hasDatingEvent ?datingEvent .
      OPTIONAL {
        ?datingEvent ti:atTime ?time .
        OPTIONAL {
          ?time rdfs:label ?timeLabel .
        }
      }
    }
  }

  ## Usage
  OPTIONAL {
    ?subject a-cd:hasUse ?use .
    OPTIONAL {
      ?use a-cd:useFunction ?useFunction .
      OPTIONAL {
        ?useFunction rdfs:label ?useFunctionLabel .
      }
    }
  }

  ## Administrative context
  OPTIONAL {
    ?subject arco:hasCataloguingAgency ?agency .
    OPTIONAL {
      ?agency skos:prefLabel ?agencyLabel .
    }
  }
}
